# Crawler Platform

**Version: v0.0.16**

åŸºäºuTLSçš„é«˜æ€§èƒ½çˆ¬è™«å¹³å°ï¼Œæ”¯æŒTLSæŒ‡çº¹ä¼ªè£…ã€çƒ­è¿æ¥æ± å’ŒIPæ± ç®¡ç†ã€‚

## é¡¹ç›®ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

- **ğŸ”¥ çƒ­è¿æ¥æ± **: é¢„å»ºç«‹TLSè¿æ¥å¹¶å¤ç”¨ï¼Œæ€§èƒ½æå‡3-6å€
- **ğŸ­ TLSæŒ‡çº¹ä¼ªè£…**: æ”¯æŒ33ç§çœŸå®æµè§ˆå™¨æŒ‡çº¹ï¼Œæ¨¡æ‹ŸChromeã€Firefoxã€Safariã€Edgeç­‰
- **ğŸŒ å¤šè¯­è¨€æ”¯æŒ**: éšæœºç”ŸæˆAccept-Languageå¤´ï¼Œä»90ç§è¯­è¨€ä¸­ç»„åˆï¼Œ97.8%ç‹¬ç‰¹æ€§
- **ğŸ“¡ åŒåè®®æ”¯æŒ**: è‡ªåŠ¨æ£€æµ‹HTTP/1.1å’ŒHTTP/2ï¼Œå®Œç¾æ”¯æŒh2è¿æ¥å¤ç”¨
- **ğŸŒ åŒæ ˆç½‘ç»œ**: å®Œæ•´æ”¯æŒIPv4å’ŒIPv6åœ°å€
- **ğŸ”’ å®‰å…¨å¯é **: æ­»é”é¢„é˜²ã€è¿æ¥å¥åº·æ£€æŸ¥ã€è‡ªåŠ¨é‡è¯•æœºåˆ¶

### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **é¢„çƒ­é€Ÿåº¦** | 75è¿æ¥/ç§’ | 1611ä¸ªè¿æ¥åœ¨21.5ç§’å†…å»ºç«‹å®Œæˆ |
| **æˆåŠŸç‡** | 98.8% | é«˜å¯ç”¨æ€§ä¿è¯ |
| **è¿æ¥å¤ç”¨ç‡** | 100% | HTTP/2å®Œç¾å¤ç”¨ |
| **æ€§èƒ½æå‡** | 3-6å€ | ç›¸æ¯”æ¯æ¬¡æ–°å»ºè¿æ¥ |
| **æŒ‡çº¹å¤šæ ·æ€§** | 33ç§ | TLSæŒ‡çº¹å‡åŒ€åˆ†å¸ƒ |
| **è¯­è¨€ç‹¬ç‰¹æ€§** | 97.8% | Accept-Languageç»„åˆç‹¬ç‰¹æ€§ |

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
go mod download
```

### åŸºæœ¬ä½¿ç”¨

```go
package main

import (
    "net/http"
    "crawler-platform/utlsclient"
)

func main() {
    // åˆ›å»ºçƒ­è¿æ¥æ± 
    pool := utlsclient.NewUTLSHotConnPool(nil)
    defer pool.Close()

    // è·å–è¿æ¥
    conn, err := pool.GetConnection("kh.google.com")
    if err != nil {
        panic(err)
    }

    // ä½¿ç”¨è¿æ¥å‘é€è¯·æ±‚
    client := utlsclient.NewUTLSClient(conn)
    req, _ := http.NewRequest("GET", "https://kh.google.com/rt/earth/PlanetoidMetadata", nil)
    resp, err := client.Do(req)
    if err != nil {
        panic(err)
    }
    defer resp.Body.Close()

    // å½’è¿˜è¿æ¥åˆ°æ± ä¸­
    pool.PutConnection(conn)
}
```

## é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ cmd/                    # å‘½ä»¤è¡Œå·¥å…·
â”‚   â””â”€â”€ utlsclient/        # uTLSå®¢æˆ·ç«¯CLI
â”œâ”€â”€ utlsclient/            # uTLSå®¢æˆ·ç«¯æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ utlshotconnpool.go # çƒ­è¿æ¥æ± å®ç°
â”‚   â”œâ”€â”€ utlsclient.go      # HTTPå®¢æˆ·ç«¯ï¼ˆHTTP/1.1 & HTTP/2ï¼‰
â”‚   â”œâ”€â”€ utlsfingerprint.go # TLSæŒ‡çº¹åº“ï¼ˆ33ç§+90ç§è¯­è¨€ï¼‰
â”‚   â””â”€â”€ ...                # å…¶ä»–æ¨¡å—
â”œâ”€â”€ test/                  # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ reports/           # æµ‹è¯•æŠ¥å‘Š
â”‚   â”œâ”€â”€ results/           # æµ‹è¯•ç»“æœ
â”‚   â””â”€â”€ test_ip_pool_performance.go
â”œâ”€â”€ dns/                   # DNSè§£ææ¨¡å—
â”œâ”€â”€ logger/                # æ—¥å¿—æ¨¡å—
â””â”€â”€ ...                    # å…¶ä»–æ¨¡å—
```

## æ ¸å¿ƒæ¨¡å—

### 1. çƒ­è¿æ¥æ±  (UTLSHotConnPool)

çƒ­è¿æ¥æ± é€šè¿‡é¢„å»ºç«‹å’Œå¤ç”¨TLSè¿æ¥ï¼Œå¤§å¹…æå‡æ€§èƒ½ï¼š

**å·¥ä½œæµç¨‹**:
1. **é¢„çƒ­é˜¶æ®µ**: ä¸ºæ‰€æœ‰IPå»ºç«‹TLSè¿æ¥
2. **è·å–è¿æ¥**: ä»æ± ä¸­è·å–å¯ç”¨è¿æ¥
3. **ä½¿ç”¨è¿æ¥**: å‘é€HTTP/HTTPSè¯·æ±‚
4. **å½’è¿˜è¿æ¥**: è¯·æ±‚å®Œæˆåå½’è¿˜åˆ°æ± ä¸­
5. **è¿æ¥å¤ç”¨**: ä¸‹æ¬¡è¯·æ±‚ç›´æ¥å¤ç”¨ç°æœ‰è¿æ¥

**å…³é”®ç‰¹æ€§**:
- âœ… è‡ªåŠ¨åè®®æ£€æµ‹ï¼ˆHTTP/1.1 / HTTP/2ï¼‰
- âœ… è¿æ¥å¥åº·æ£€æŸ¥å’Œè¶…æ—¶ç®¡ç†
- âœ… å¹¶å‘å®‰å…¨ï¼ˆå¤šçº§é”æœºåˆ¶ï¼‰
- âœ… æ­»é”é¢„é˜²ï¼ˆåŒé‡æ£€æŸ¥æ¨¡å¼ï¼‰
- âœ… ç™½åå•æœºåˆ¶ï¼ˆIPæˆåŠŸéªŒè¯ååŠ å…¥ç™½åå•ï¼‰

### 2. TLSæŒ‡çº¹ä¼ªè£…

æ”¯æŒ33ç§çœŸå®æµè§ˆå™¨TLSæŒ‡çº¹é…ç½®ï¼š

**Chromeç³»åˆ—** (12ç§):
- Chrome 133, 131, 120, 115-PQ, 114, 112, 106, 102, 100, 96, 87, 83, Auto

**Firefoxç³»åˆ—** (9ç§):
- Firefox 120, 105, 102, 99, 65, 63, 56, 55, Auto

**Safariç³»åˆ—** (4ç§):
- Safari 17 (macOS), iOS Safari 14/13/12 (iPhone)

**Edgeç³»åˆ—** (3ç§):
- Edge 106, 85, Auto

æ¯æ¬¡å»ºç«‹è¿æ¥æ—¶éšæœºé€‰æ‹©ä¸€ä¸ªæŒ‡çº¹ï¼Œæ¨¡æ‹ŸçœŸå®æµè§ˆå™¨è¡Œä¸ºã€‚

### 3. Accept-LanguageéšæœºåŒ–

ä»90ç§è¯­è¨€ä¸­éšæœºç»„åˆ2-5ç§è¯­è¨€ï¼Œç”Ÿæˆç‹¬ç‰¹çš„Accept-Languageå¤´ï¼š

**ç¤ºä¾‹**:
```
cs-CZ,uk-UA;q=0.9,bn-IN;q=0.8,no-NO;q=0.7,ro-RO;q=0.6
th-TH,sr-RS;q=0.9,da-DK;q=0.8,ta-LK;q=0.7,lt-LT;q=0.6
vi-VN,en-GB;q=0.9,cs-CZ;q=0.8,zh-HK;q=0.7,de-DE;q=0.6
```

åœ¨1611ä¸ªè¿æ¥çš„æµ‹è¯•ä¸­ï¼Œç”Ÿæˆäº†1575ç§ç‹¬ç‰¹çš„è¯­è¨€ç»„åˆï¼ˆ97.8%ç‹¬ç‰¹æ€§ï¼‰ã€‚

### 4. HTTP/2æ”¯æŒ

å®Œæ•´å®ç°HTTP/2åè®®æ”¯æŒï¼š

```go
// è‡ªåŠ¨æ£€æµ‹åå•†çš„åè®®
negotiatedProto := conn.tlsConn.ConnectionState().NegotiatedProtocol

if negotiatedProto == "h2" {
    // ä½¿ç”¨HTTP/2å®¢æˆ·ç«¯
    return c.doHTTP2Request(ctx, req)
} else {
    // ä½¿ç”¨HTTP/1.1
    return c.doHTTP1Request(ctx, req)
}
```

**å…³é”®æ”¹è¿›**:
- âœ… HTTP/2 ClientConnç¼“å­˜å’Œå¤ç”¨
- âœ… è¿æ¥å¯ç”¨æ€§æ£€æŸ¥ï¼ˆCanTakeNewRequestï¼‰
- âœ… è‡ªåŠ¨åè®®é™çº§
- âœ… è¿æ¥é”™è¯¯è‡ªåŠ¨é‡å»º

### 5. IPv6æ”¯æŒ

å®Œæ•´æ”¯æŒIPv6åœ°å€è¿æ¥ï¼š

```go
// å¤„ç†IPv6åœ°å€æ ¼å¼ï¼šéœ€è¦ç”¨æ–¹æ‹¬å·åŒ…è£¹
var address string
if strings.Contains(ip, ":") {
    // IPv6åœ°å€
    address = fmt.Sprintf("[%s]:%d", ip, DefaultHTTPSPort)
} else {
    // IPv4åœ°å€
    address = fmt.Sprintf("%s:%d", ip, DefaultHTTPSPort)
}
```

åœ¨å®é™…æµ‹è¯•ä¸­ï¼ŒæˆåŠŸè¿æ¥791ä¸ªIPv6åœ°å€ï¼ŒæˆåŠŸç‡ä¸IPv4ç›¸å½“ã€‚

## æ€§èƒ½æµ‹è¯•

### æµ‹è¯•è§„æ¨¡

- **IPæ± å¤§å°**: 1631ä¸ªï¼ˆ840 IPv4 + 791 IPv6ï¼‰
- **æµ‹è¯•URL**: 4ä¸ªGoogle Earth APIç«¯ç‚¹
- **æ€»è¯·æ±‚æ•°**: 6524æ¬¡ï¼ˆ1631 IP Ã— 4 URLï¼‰

### æµ‹è¯•ç»“æœ

**é¢„çƒ­é˜¶æ®µ**:
- æˆåŠŸå»ºç«‹: 1611ä¸ªè¿æ¥ï¼ˆ98.8%æˆåŠŸç‡ï¼‰
- æ€»è€—æ—¶: 21.5ç§’
- å¹³å‡é€Ÿåº¦: 75è¿æ¥/ç§’

**çƒ­è¿æ¥é˜¶æ®µ**:
- ç¬¬1è½®: 1631æ¬¡è¯·æ±‚ï¼Œ100%æˆåŠŸï¼Œè€—æ—¶~6ç§’
- ç¬¬2è½®: 1631æ¬¡è¯·æ±‚ï¼Œ100%æˆåŠŸï¼Œè€—æ—¶~6ç§’
- ç¬¬3è½®: 1631æ¬¡è¯·æ±‚ï¼Œ100%æˆåŠŸï¼Œè€—æ—¶~6ç§’

**æ€§èƒ½å¯¹æ¯”**:
- é¢„çƒ­é˜¶æ®µ: å¹³å‡13ms/è¿æ¥ï¼ˆéœ€è¦TLSæ¡æ‰‹ï¼‰
- çƒ­è¿æ¥é˜¶æ®µ: å¹³å‡4ms/è¯·æ±‚ï¼ˆå¤ç”¨è¿æ¥ï¼‰
- **æ€§èƒ½æå‡: 3å€ä»¥ä¸Š**

### æŒ‡çº¹å’Œè¯­è¨€ç»Ÿè®¡

**TLSæŒ‡çº¹åˆ†å¸ƒ**ï¼ˆ33ç§ï¼‰:
- Chrome 100 - Windows: 73æ¬¡ï¼ˆ4.53%ï¼‰
- Firefox 63 - Windows: 64æ¬¡ï¼ˆ3.97%ï¼‰
- Chrome 115 PQ - Windows: 59æ¬¡ï¼ˆ3.66%ï¼‰
- ... å…¶ä»–30ç§æŒ‡çº¹å‡åŒ€åˆ†å¸ƒ

**Accept-Languageå¤šæ ·æ€§**:
- æ€»ç»„åˆæ•°: 1575ç§
- ç‹¬ç‰¹ç»„åˆ: 1541ç§ï¼ˆ97.8%ç‹¬ç‰¹æ€§ï¼‰
- å¤šæ¬¡ä½¿ç”¨: ä»…34ç§ç»„åˆè¢«ä½¿ç”¨2-3æ¬¡

è¯¦ç»†æµ‹è¯•æŠ¥å‘Šè§: `test/reports/çƒ­è¿æ¥æ± æ€§èƒ½æµ‹è¯•æŠ¥å‘Š.md`

## æŠ€æœ¯æ”¹è¿›è®°å½•

### å·²ä¿®å¤çš„é—®é¢˜

| # | é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | çŠ¶æ€ |
|---|------|----------|------|
| 1 | cleanupTickeræœªä½¿ç”¨è­¦å‘Š | åˆ é™¤æœªä½¿ç”¨å­—æ®µ | âœ… |
| 2 | HTTP/2åè®®ä¸æ”¯æŒ | æ·»åŠ HTTP/2æ£€æµ‹å’Œå¤„ç† | âœ… |
| 3 | TLSæ¡æ‰‹empty PSKé”™è¯¯ | æ·»åŠ OmitEmptyPské…ç½® | âœ… |
| 4 | HTTP/2è¿æ¥æ— æ³•å¤ç”¨ | ç¼“å­˜HTTP/2 ClientConn | âœ… |
| 5 | HTTP/2éªŒè¯å¤±è´¥ | é’ˆå¯¹h2è¿æ¥ä½¿ç”¨çŠ¶æ€æ£€æŸ¥ | âœ… |
| 6 | getExistingConnectionæ­»é” | è§£é”åå†è°ƒç”¨å¥åº·æ£€æŸ¥ | âœ… |
| 7 | IPv6åœ°å€è¿æ¥å¤±è´¥ | ä½¿ç”¨æ–¹æ‹¬å·åŒ…è£¹IPv6åœ°å€ | âœ… |
| 8 | Accept-Languageç¼ºå¤± | æ·»åŠ éšæœºè¯­è¨€ç”Ÿæˆ | âœ… |

### æ–°å¢åŠŸèƒ½

- âœ… HTTP/2åè®®è‡ªåŠ¨æ£€æµ‹å’Œåˆ‡æ¢
- âœ… IPv6åœ°å€å®Œæ•´æ”¯æŒ
- âœ… Accept-LanguageéšæœºåŒ–ï¼ˆ90ç§è¯­è¨€ï¼‰
- âœ… è¿æ¥æ± ç»Ÿè®¡ä¿¡æ¯ï¼ˆæŒ‡çº¹åˆ†å¸ƒã€è¯­è¨€åˆ†å¸ƒï¼‰
- âœ… æ€§èƒ½æµ‹è¯•æ¡†æ¶
- âœ… æ­»é”é¢„é˜²æœºåˆ¶
- âœ… åŒé‡æ£€æŸ¥æ¨¡å¼

## ä½¿ç”¨å»ºè®®

### æœ€ä½³å®è·µ

1. **é¢„çƒ­è¿æ¥**: åœ¨å¼€å§‹å¤§è§„æ¨¡è¯·æ±‚å‰ï¼Œå…ˆé¢„çƒ­æ‰€æœ‰IPçš„è¿æ¥
   ```go
   // é¢„çƒ­é˜¶æ®µ
   for _, ip := range ipPool {
       conn, _ := pool.GetConnectionToIP(url, ip)
       // å‘é€ä¸€ä¸ªç®€å•è¯·æ±‚
       client.Do(req)
       pool.PutConnection(conn)
   }
   ```

2. **è½®è¯¢ä½¿ç”¨**: é‡‡ç”¨ã€è·å–-ä½¿ç”¨-å½’è¿˜ã€‘æ¨¡å¼
   ```go
   conn, _ := pool.GetConnection(host)
   client := utlsclient.NewUTLSClient(conn)
   resp, _ := client.Do(req)
   pool.PutConnection(conn)  // ä¸€å®šè¦å½’è¿˜ï¼
   ```

3. **å¹¶å‘æ§åˆ¶**: å»ºè®®æ¯50-100ä¸ªIPåŠ ä¸€ä¸ªå°å»¶è¿Ÿ
   ```go
   if (idx+1)%100 == 0 {
       time.Sleep(100 * time.Millisecond)
   }
   ```

4. **è¶…æ—¶è®¾ç½®**: å»ºè®®è®¾ç½®10-15ç§’çš„è¯·æ±‚è¶…æ—¶
   ```go
   client.SetTimeout(15 * time.Second)
   ```

5. **é”™è¯¯é‡è¯•**: å¯¹äºå¤±è´¥çš„è¯·æ±‚ï¼Œå¯ä»¥é‡è¯•æˆ–åˆ‡æ¢IP

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. ä½¿ç”¨è¿æ¥æ± è€Œéæ¯æ¬¡åˆ›å»ºæ–°è¿æ¥ï¼Œæ€§èƒ½æå‡3-6å€
2. é¢„çƒ­é˜¶æ®µå¯ä»¥å¼‚æ­¥è¿›è¡Œï¼Œä¸é˜»å¡ä¸»ä¸šåŠ¡
3. å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œå®šæœŸæ£€æŸ¥å’Œæ¸…ç†è¿‡æœŸè¿æ¥
4. æ ¹æ®å®é™…ç½‘ç»œæƒ…å†µè°ƒæ•´å¹¶å‘æ•°å’Œè¶…æ—¶æ—¶é—´
5. ä½¿ç”¨HTTP/2æ—¶ï¼Œä¸€ä¸ªè¿æ¥å¯ä»¥å¤„ç†å¤šä¸ªå¹¶å‘è¯·æ±‚

## æµ‹è¯•

### è¿è¡Œæ€§èƒ½æµ‹è¯•

```bash
# è¿è¡ŒIPæ± æ€§èƒ½æµ‹è¯•
go run test/test_ip_pool_performance.go

# ä¿å­˜ç»“æœ
go run test/test_ip_pool_performance.go > test/results/output.txt 2>&1
```

### è¿è¡Œå•å…ƒæµ‹è¯•

```bash
# æµ‹è¯•çƒ­è¿æ¥æ± 
go test ./utlsclient -v -run TestUTLSHotConnPool

# æµ‹è¯•TLSæŒ‡çº¹
go test ./utlsclient -v -run TestFingerprint

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
go test ./... -v
```

### æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š

```bash
# å®Œæ•´æµ‹è¯•æŠ¥å‘Š
cat test/reports/çƒ­è¿æ¥æ± æ€§èƒ½æµ‹è¯•æŠ¥å‘Š.md

# æŸ¥çœ‹TLSæŒ‡çº¹ç»Ÿè®¡
grep -A 40 "TLSæŒ‡çº¹ç»Ÿè®¡" test/results/ip_pool_full_stats.txt

# æŸ¥çœ‹è¯­è¨€å¤šæ ·æ€§ç»Ÿè®¡
grep -A 50 "Accept-Languageç»Ÿè®¡" test/results/ip_pool_full_stats.txt
```

## ä¾èµ–åº“

- **refraction-networking/utls**: uTLSåº“ï¼Œç”¨äºTLSæŒ‡çº¹ä¼ªè£…
- **golang.org/x/net/http2**: HTTP/2åè®®æ”¯æŒ
- å…¶ä»–æ ‡å‡†åº“

## è®¸å¯è¯

[æ·»åŠ è®¸å¯è¯ä¿¡æ¯]

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## æ›´æ–°æ—¥å¿—

### 2025-11-18

- âœ… å®Œæˆçƒ­è¿æ¥æ± æ€§èƒ½ä¼˜åŒ–
- âœ… æ·»åŠ HTTP/2å®Œæ•´æ”¯æŒ
- âœ… å®ç°IPv6åœ°å€æ”¯æŒ
- âœ… æ·»åŠ Accept-LanguageéšæœºåŒ–
- âœ… ä¿®å¤æ­»é”é—®é¢˜
- âœ… å®Œæˆå¤§è§„æ¨¡æ€§èƒ½æµ‹è¯•ï¼ˆ1631 IP Ã— 4 URLï¼‰
- âœ… ç”Ÿæˆè¯¦ç»†æµ‹è¯•æŠ¥å‘Š
