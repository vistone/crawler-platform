# æ ¸å¿ƒåŠŸèƒ½

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [README.md](file://README.md)
- [utlsclient/utlshotconnpool.go](file://utlsclient/utlshotconnpool.go)
- [utlsclient/utlsfingerprint.go](file://utlsclient/utlsfingerprint.go)
- [localippool/localippool.go](file://localippool/localippool.go)
- [remotedomainippool/remotedomainippool.go](file://remotedomainippool/remotedomainippool.go)
- [utlsclient/utlsclient.go](file://utlsclient/utlsclient.go)
- [utlsclient/connection_manager.go](file://utlsclient/connection_manager.go)
- [utlsclient/health_checker.go](file://utlsclient/health_checker.go)
- [examples/utlsclient/example_hotconnpool_usage.go](file://examples/utlsclient/example_hotconnpool_usage.go)
- [examples/utlsclient/example_utlsclient_usage.go](file://examples/utlsclient/example_utlsclient_usage.go)
- [GoogleEarth/geq2.go](file://GoogleEarth/geq2.go) - *æ–°å¢ Google Earth Q2 æ•°æ®è§£æåŠŸèƒ½*
- [GoogleEarth/gedbroot.go](file://GoogleEarth/gedbroot.go) - *æ–°å¢ dbRoot è§£æåŠŸèƒ½*
- [Store/sqlitedb.go](file://Store/sqlitedb.go) - *æ–°å¢ SQLite å­˜å‚¨æ”¯æŒ*
- [Store/tilestorage.go](file://Store/tilestorage.go) - *æ–°å¢ç“¦ç‰‡å­˜å‚¨ç®¡ç†åŠŸèƒ½*
</cite>

## æ›´æ–°æ‘˜è¦
**å˜æ›´å†…å®¹**
- æ–°å¢ Google Earth Q2 æ•°æ®è§£æä¸å­˜å‚¨æ¶æ„ç« èŠ‚
- æ‰©å±•é¡¹ç›®æ¶æ„æ¦‚è§ˆå›¾ä»¥åŒ…å«æ–°åŠŸèƒ½æ¨¡å—
- æ–°å¢ Q2 æ•°æ®è§£ææµç¨‹å›¾
- æ›´æ–°åŠŸèƒ½ä¾èµ–å…³ç³»åˆ†æä»¥åŒ…å«æ–°ç»„ä»¶
- æ·»åŠ æ€§èƒ½ä¼˜åŒ–å»ºè®®å’Œæœ€ä½³å®è·µæŒ‡å—

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®æ¶æ„æ¦‚è§ˆ](#é¡¹ç›®æ¶æ„æ¦‚è§ˆ)
3. [çƒ­è¿æ¥æ± æ ¸å¿ƒåŠŸèƒ½](#çƒ­è¿æ¥æ± æ ¸å¿ƒåŠŸèƒ½)
4. [TLSæŒ‡çº¹ä¼ªè£…æŠ€æœ¯](#tlsæŒ‡çº¹ä¼ªè£…æŠ€æœ¯)
5. [IPæ± ç®¡ç†æœºåˆ¶](#ipæ± ç®¡ç†æœºåˆ¶)
6. [HTTPåè®®æ”¯æŒ](#httpåè®®æ”¯æŒ)
7. [Google Earth Q2æ•°æ®è§£æä¸å­˜å‚¨](#google-earth-q2æ•°æ®è§£æä¸å­˜å‚¨)
8. [åŠŸèƒ½ä¾èµ–å…³ç³»åˆ†æ](#åŠŸèƒ½ä¾èµ–å…³ç³»åˆ†æ)
9. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)
10. [æœ€ä½³å®è·µæŒ‡å—](#æœ€ä½³å®è·µæŒ‡å—)
11. [æ€»ç»“](#æ€»ç»“)

## ç®€ä»‹

Crawler Platform æ˜¯ä¸€ä¸ªåŸºäº uTLS çš„é«˜æ€§èƒ½çˆ¬è™«å¹³å°ï¼Œä¸“é—¨è®¾è®¡ç”¨äºç»•è¿‡ç°ä»£ Web åº”ç”¨çš„å®‰å…¨æ£€æµ‹æœºåˆ¶ã€‚è¯¥é¡¹ç›®é€šè¿‡åˆ›æ–°çš„æŠ€æœ¯ç»„åˆï¼Œå®ç°äº†çªç ´æ€§çš„æ€§èƒ½æå‡å’Œé«˜åº¦çš„éšè”½æ€§ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **ğŸ”¥ çƒ­è¿æ¥æ± **: é¢„å»ºç«‹ TLS è¿æ¥å¹¶å¤ç”¨ï¼Œæ€§èƒ½æå‡ 3-6 å€
- **ğŸ­ TLS æŒ‡çº¹ä¼ªè£…**: æ”¯æŒ 33 ç§çœŸå®æµè§ˆå™¨æŒ‡çº¹ï¼Œæ¨¡æ‹Ÿ Chromeã€Firefoxã€Safariã€Edge ç­‰
- **ğŸŒ å¤šè¯­è¨€æ”¯æŒ**: éšæœºç”Ÿæˆ Accept-Language å¤´ï¼Œä» 90 ç§è¯­è¨€ä¸­ç»„åˆï¼Œ97.8% ç‹¬ç‰¹æ€§
- **ğŸ“¡ åŒåè®®æ”¯æŒ**: è‡ªåŠ¨æ£€æµ‹ HTTP/1.1 å’Œ HTTP/2ï¼Œå®Œç¾æ”¯æŒ h2 è¿æ¥å¤ç”¨
- **ğŸŒ åŒæ ˆç½‘ç»œ**: å®Œæ•´æ”¯æŒ IPv4 å’Œ IPv6 åœ°å€
- **ğŸ”’ å®‰å…¨å¯é **: æ­»é”é¢„é˜²ã€è¿æ¥å¥åº·æ£€æŸ¥ã€è‡ªåŠ¨é‡è¯•æœºåˆ¶
- **ğŸ›°ï¸ Google Earth Q2 æ”¯æŒ**: æ–°å¢ Q2 æ•°æ®è§£æã€dbRoot è§£æå’Œ SQLite å­˜å‚¨åŠŸèƒ½

## é¡¹ç›®æ¶æ„æ¦‚è§ˆ

```mermaid
graph TB
subgraph "ç”¨æˆ·æ¥å£å±‚"
CLI[å‘½ä»¤è¡Œå·¥å…·]
API[HTTP API]
end
subgraph "æ ¸å¿ƒæœåŠ¡å±‚"
HC[çƒ­è¿æ¥æ± <br/>UTLSHotConnPool]
FP[TLSæŒ‡çº¹åº“<br/>Library]
IP[IPæ± ç®¡ç†<br/>IPPoolProvider]
AC[è®¿é—®æ§åˆ¶å™¨<br/>IPAccessController]
end
subgraph "è¿æ¥ç®¡ç†å±‚"
CM[è¿æ¥ç®¡ç†å™¨<br/>ConnectionManager]
HC_CHECK[å¥åº·æ£€æŸ¥å™¨<br/>HealthChecker]
CV[è¿æ¥éªŒè¯å™¨<br/>ConnectionValidator]
end
subgraph "ä¼ è¾“å±‚"
TC[UTLSå®¢æˆ·ç«¯<br/>UTLSClient]
HTTP1[HTTP/1.1å¤„ç†å™¨]
HTTP2[HTTP/2å¤„ç†å™¨]
end
subgraph "ç½‘ç»œå±‚"
IPv4[IPv4åœ°å€æ± ]
IPv6[IPv6åœ°å€æ± ]
DNS[DNSè§£æå™¨]
end
subgraph "Google Earth ä¸“ç”¨æ¨¡å—"
GE_AUTH[è®¤è¯ç®¡ç†å™¨<br/>Auth]
GE_DBROOT[dbRootè§£æå™¨<br/>DbRootParser]
GE_Q2[Q2æ•°æ®è§£æå™¨<br/>Q2Parser]
end
subgraph "å­˜å‚¨å±‚"
STORAGE[ç“¦ç‰‡å­˜å‚¨ç®¡ç†å™¨<br/>TileStorage]
SQLITE[SQLiteå­˜å‚¨<br/>SQLiteManager]
REDIS[Redisç¼“å­˜]
end
CLI --> HC
API --> HC
HC --> CM
HC --> FP
HC --> IP
HC --> AC
CM --> HC_CHECK
CM --> CV
HC --> TC
TC --> HTTP1
TC --> HTTP2
IP --> IPv4
IP --> IPv6
IP --> DNS
TC --> GE_AUTH
GE_AUTH --> GE_DBROOT
GE_DBROOT --> GE_Q2
GE_Q2 --> STORAGE
STORAGE --> SQLITE
STORAGE --> REDIS
```

**å›¾è¡¨æ¥æº**
- [utlsclient/utlshotconnpool.go](file://utlsclient/utlshotconnpool.go#L236-L258)
- [utlsclient/connection_manager.go](file://utlsclient/connection_manager.go#L8-L14)
- [localippool/localippool.go](file://localippool/localippool.go#L32-L69)
- [GoogleEarth/geq2.go](file://GoogleEarth/geq2.go#L1-L481)
- [Store/tilestorage.go](file://Store/tilestorage.go#L42-L51)

## çƒ­è¿æ¥æ± æ ¸å¿ƒåŠŸèƒ½

### è®¾è®¡ç†å¿µ

çƒ­è¿æ¥æ± æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œé€šè¿‡é¢„å»ºç«‹å’Œå¤ç”¨ TLS è¿æ¥æ¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚å…¶è®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **é¢„çƒ­æœºåˆ¶**: åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶é¢„å…ˆå»ºç«‹å¤§é‡è¿æ¥
2. **æ™ºèƒ½å¤ç”¨**: æ ¹æ®è´Ÿè½½åŠ¨æ€åˆ†é…å¯ç”¨è¿æ¥
3. **å¥åº·ç›‘æ§**: æŒç»­ç›‘æ§è¿æ¥çŠ¶æ€ï¼ŒåŠæ—¶å‰”é™¤æ•…éšœè¿æ¥
4. **å¹¶å‘å®‰å…¨**: ä½¿ç”¨å¤šçº§é”æœºåˆ¶ç¡®ä¿é«˜å¹¶å‘ä¸‹çš„å®‰å…¨æ€§

### æ ¸å¿ƒæ¶æ„

```mermaid
classDiagram
class UTLSHotConnPool {
+connManager : ConnectionManager
+healthChecker : HealthChecker
+validator : ConnectionValidator
+ipAccessCtrl : IPAccessController
+config : PoolConfig
+stats : PoolStats
+GetConnection(targetHost) UTLSConnection
+PutConnection(conn) void
+GetStats() PoolStats
+IsHealthy() bool
+Close() error
}
class ConnectionManager {
+connections : map[string]*UTLSConnection
+hostMapping : map[string][]string
+config : PoolConfig
+AddConnection(conn) void
+RemoveConnection(ip) void
+GetConnectionsForHost(host) []*UTLSConnection
+CleanupIdleConnections() int
}
class UTLSConnection {
+conn : net.Conn
+tlsConn : *utls.UConn
+targetIP : string
+targetHost : string
+fingerprint : Profile
+acceptLanguage : string
+h2ClientConn : interface{}
+inUse : bool
+healthy : bool
+requestCount : int64
+errorCount : int64
+mu : sync.Mutex
+cond : sync.Cond
}
UTLSHotConnPool --> ConnectionManager
UTLSHotConnPool --> UTLSConnection
ConnectionManager --> UTLSConnection
```

**å›¾è¡¨æ¥æº**
- [utlsclient/utlshotconnpool.go](file://utlsclient/utlshotconnpool.go#L236-L258)
- [utlsclient/connection_manager.go](file://utlsclient/connection_manager.go#L8-L14)
- [utlsclient/utlsclient.go](file://utlsclient/utlsclient.go#L37-L52)

### å·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
participant Client as å®¢æˆ·ç«¯
participant Pool as çƒ­è¿æ¥æ± 
participant Manager as è¿æ¥ç®¡ç†å™¨
participant Validator as è¿æ¥éªŒè¯å™¨
participant IP as IPæ± 
participant Target as ç›®æ ‡æœåŠ¡å™¨
Client->>Pool : GetConnection(host)
Pool->>Manager : GetConnectionsForHost(host)
Manager-->>Pool : å¯ç”¨è¿æ¥åˆ—è¡¨
alt æ‰¾åˆ°å¯ç”¨è¿æ¥
Pool->>Pool : æ£€æŸ¥è¿æ¥å¥åº·çŠ¶æ€
Pool-->>Client : è¿”å›å¥åº·è¿æ¥
else æ— å¯ç”¨è¿æ¥
Pool->>IP : è·å–æ–°IP
IP-->>Pool : åˆ†é…IPåœ°å€
Pool->>Pool : åˆ›å»ºæ–°è¿æ¥
Pool->>Validator : éªŒè¯è¿æ¥å¯ç”¨æ€§
Validator->>Target : æµ‹è¯•è¯·æ±‚
Target-->>Validator : å“åº”
Validator-->>Pool : éªŒè¯ç»“æœ
Pool->>Manager : æ·»åŠ åˆ°è¿æ¥æ± 
Pool-->>Client : è¿”å›æ–°è¿æ¥
end
Client->>Pool : PutConnection(conn)
Pool->>Manager : æ ‡è®°è¿æ¥å¯ç”¨
```

**å›¾è¡¨æ¥æº**
- [utlsclient/utlshotconnpool.go](file://utlsclient/utlshotconnpool.go#L351-L395)
- [utlsclient/connection_manager.go](file://utlsclient/connection_manager.go#L76-L90)

### å…³é”®ç‰¹æ€§

1. **åŒé‡æ£€æŸ¥æ¨¡å¼**: é¿å…æ­»é”çš„å¹¶å‘å®‰å…¨æœºåˆ¶
2. **è¿æ¥å¥åº·æ£€æŸ¥**: å®šæœŸéªŒè¯è¿æ¥å¯ç”¨æ€§
3. **è‡ªåŠ¨é‡è¯•æœºåˆ¶**: è¿æ¥å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
4. **ç»Ÿè®¡ç›‘æ§**: å®æ—¶è·Ÿè¸ªè¿æ¥æ± çŠ¶æ€

**ç« èŠ‚æ¥æº**
- [utlsclient/utlshotconnpool.go](file://utlsclient/utlshotconnpool.go#L351-L800)

## TLSæŒ‡çº¹ä¼ªè£…æŠ€æœ¯

### æŠ€æœ¯åŸç†

TLS æŒ‡çº¹ä¼ªè£…æ˜¯é€šè¿‡æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨çš„ TLS æ¡æ‰‹è¿‡ç¨‹æ¥éšè—çˆ¬è™«èº«ä»½ã€‚ç³»ç»Ÿæ”¯æŒ 33 ç§ä¸åŒçš„æµè§ˆå™¨æŒ‡çº¹ï¼Œæ¶µç›–ä¸»æµæµè§ˆå™¨çš„å„ç§ç‰ˆæœ¬ã€‚

### æŒ‡çº¹åº“æ¶æ„

```mermaid
classDiagram
class Library {
+profiles : []Profile
+rand : *rand.Rand
+mu : sync.Mutex
+All() []Profile
+RandomProfile() Profile
+ProfileByName(name) Profile
+ProfilesByBrowser(browser) []Profile
+ProfilesByPlatform(platform) []Profile
+RecommendedProfiles() []Profile
+RandomAcceptLanguage() string
}
class Profile {
+Name : string
+HelloID : utls.ClientHelloID
+UserAgent : string
+Description : string
+Platform : string
+Browser : string
+Version : string
}
Library --> Profile
```

**å›¾è¡¨æ¥æº**
- [utlsclient/utlsfingerprint.go](file://utlsclient/utlsfingerprint.go#L13-L29)

### æ”¯æŒçš„æµè§ˆå™¨æŒ‡çº¹

| æµè§ˆå™¨ç³»åˆ— | ç‰ˆæœ¬æ•°é‡ | æ”¯æŒå¹³å° | æè¿° |
|------------|----------|----------|------|
| Chrome | 12ç§ | Windows, macOS, Linux | ä¸»æµæ¡Œé¢æµè§ˆå™¨ï¼Œæ”¯æŒæœ€æ–°ç‰ˆæœ¬ |
| Firefox | 9ç§ | Windows, macOS | å¼€æºæµè§ˆå™¨ï¼Œæ”¯æŒç¨³å®šç‰ˆæœ¬ |
| Safari | 4ç§ | macOS, iOS | è‹¹æœç”Ÿæ€ç³»ç»Ÿæµè§ˆå™¨ |
| Edge | 3ç§ | Windows | å¾®è½¯æµè§ˆå™¨ï¼ŒåŸºäº Chromium |
| Randomized | 3ç§ | Random | éšæœºåŒ–æŒ‡çº¹ï¼Œå¢å¼ºéšè”½æ€§ |

### Accept-Language éšæœºåŒ–

ç³»ç»Ÿä» 90 ç§è¯­è¨€ä¸­éšæœºç»„åˆ 2-5 ç§è¯­è¨€ï¼Œç”Ÿæˆç‹¬ç‰¹çš„ Accept-Language å¤´ï¼š

```mermaid
flowchart TD
Start(["å¼€å§‹ç”Ÿæˆ"]) --> SelectCount["éšæœºé€‰æ‹©è¯­è¨€æ•°é‡<br/>2-5ç§"]
SelectCount --> GenLang["ç”Ÿæˆéšæœºè¯­è¨€åˆ—è¡¨"]
GenLang --> CheckUnique{"è¯­è¨€å”¯ä¸€æ€§æ£€æŸ¥"}
CheckUnique --> |é‡å¤| GenLang
CheckUnique --> |å”¯ä¸€| AddQuality["æ·»åŠ æƒé‡(Qå€¼)"]
AddQuality --> Format["æ ¼å¼åŒ–è¾“å‡º"]
Format --> End(["å®Œæˆ"])
```

**å›¾è¡¨æ¥æº**
- [utlsclient/utlsfingerprint.go](file://utlsclient/utlsfingerprint.go#L589-L630)

### æ€§èƒ½æŒ‡æ ‡

- **æŒ‡çº¹å¤šæ ·æ€§**: 33 ç§ä¸åŒæµè§ˆå™¨æŒ‡çº¹å‡åŒ€åˆ†å¸ƒ
- **è¯­è¨€ç‹¬ç‰¹æ€§**: 97.8% çš„ Accept-Language ç»„åˆå…·æœ‰ç‹¬ç‰¹æ€§
- **éšæœºåŒ–æ•ˆæœ**: æ¯æ¬¡å»ºç«‹è¿æ¥æ—¶éšæœºé€‰æ‹©æŒ‡çº¹ï¼Œæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º

**ç« èŠ‚æ¥æº**
- [utlsclient/utlsfingerprint.go](file://utlsclient/utlsfingerprint.go#L112-L631)

## IPæ± ç®¡ç†æœºåˆ¶

### åŒå±‚IPæ± æ¶æ„

ç³»ç»Ÿé‡‡ç”¨åŒå±‚ IP æ± æ¶æ„ï¼Œç»“åˆæœ¬åœ° IP æ± å’Œè¿œç¨‹åŸŸå IP æ± ï¼Œæä¾›çµæ´»çš„ IP ç®¡ç†ç­–ç•¥ã€‚

```mermaid
graph TB
subgraph "IPæ± ç®¡ç†å±‚"
IPM[IPæ± ç®¡ç†å™¨]
WBC[ç™½åå•/é»‘åå•æ§åˆ¶å™¨]
end
subgraph "æœ¬åœ°IPæ± "
LIP[LocalIPPool]
StaticIPv4[é™æ€IPv4æ± ]
DynamicIPv6[åŠ¨æ€IPv6æ± ]
end
subgraph "è¿œç¨‹IPæ± "
RIP[RemoteDomainIPPool]
Monitor[åŸŸåç›‘æ§å™¨]
DNSResolver[DNSè§£æå™¨]
IPInfo[IPä¿¡æ¯æŸ¥è¯¢]
end
IPM --> LIP
IPM --> RIP
IPM --> WBC
LIP --> StaticIPv4
LIP --> DynamicIPv6
RIP --> Monitor
Monitor --> DNSResolver
Monitor --> IPInfo
```

**å›¾è¡¨æ¥æº**
- [localippool/localippool.go](file://localippool/localippool.go#L32-L69)
- [remotedomainippool/remotedomainippool.go](file://remotedomainippool/remotedomainippool.go#L101-L109)

### æœ¬åœ°IPæ± åŠŸèƒ½

æœ¬åœ° IP æ± å…·å¤‡æ™ºèƒ½è‡ªé€‚åº”èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ ¹æ®ç³»ç»Ÿç¯å¢ƒè‡ªåŠ¨è°ƒæ•´ï¼š

1. **IPv4æ”¯æŒ**: ä½¿ç”¨é™æ€é…ç½®çš„ IPv4 åœ°å€
2. **IPv6åŠ¨æ€ç”Ÿæˆ**: åœ¨æ”¯æŒçš„ç¯å¢ƒä¸­åŠ¨æ€ç”Ÿæˆ IPv6 åœ°å€
3. **ç¯å¢ƒæ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿç½‘ç»œé…ç½®
4. **æ‰¹é‡ç®¡ç†**: æ”¯æŒæ‰¹é‡åˆ›å»ºå’Œæ¸…ç† IP åœ°å€

### è¿œç¨‹åŸŸåIPæ± 

è¿œç¨‹åŸŸå IP æ± é€šè¿‡å®æ—¶ç›‘æ§åŸŸåå˜åŒ–æ¥ç»´æŠ¤æœ€æ–°çš„ IP åœ°å€æ± ï¼š

```mermaid
sequenceDiagram
participant Monitor as åŸŸåç›‘æ§å™¨
participant DNS as DNSè§£æå™¨
participant API as IPä¿¡æ¯API
participant Storage as å­˜å‚¨ç³»ç»Ÿ
loop å®šæœŸæ›´æ–°
Monitor->>DNS : å¹¶å‘DNSæŸ¥è¯¢
DNS-->>Monitor : è¿”å›IPåˆ—è¡¨
Monitor->>Monitor : å»é‡å’Œè¿‡æ»¤
Monitor->>API : æŸ¥è¯¢IPè¯¦ç»†ä¿¡æ¯
API-->>Monitor : è¿”å›IPä¿¡æ¯
Monitor->>Storage : ä¿å­˜åˆ°æ–‡ä»¶
Storage-->>Monitor : ç¡®è®¤ä¿å­˜
end
```

**å›¾è¡¨æ¥æº**
- [remotedomainippool/remotedomainippool.go](file://remotedomainippool/remotedomainippool.go#L286-L355)

### IPè®¿é—®æ§åˆ¶

ç³»ç»Ÿæä¾›å®Œå–„çš„ç™½åå•å’Œé»‘åå•æœºåˆ¶ï¼š

- **ç™½åå•**: è®°å½•ç»è¿‡éªŒè¯çš„å¯ç”¨ IP
- **é»‘åå•**: è¿‡æ»¤æ‰è¢«å°ç¦æˆ–ä¸å¯ç”¨çš„ IP
- **åŠ¨æ€æ›´æ–°**: æ ¹æ®è¿æ¥æˆåŠŸç‡è‡ªåŠ¨è°ƒæ•´é»‘ç™½åå•

**ç« èŠ‚æ¥æº**
- [localippool/localippool.go](file://localippool/localippool.go#L1-L800)
- [remotedomainippool/remotedomainippool.go](file://remotedomainippool/remotedomainippool.go#L1-L472)

## HTTPåè®®æ”¯æŒ

### åŒåè®®è‡ªåŠ¨æ£€æµ‹

ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å’Œåå•† HTTP/1.1 å’Œ HTTP/2 åè®®ï¼š

```mermaid
flowchart TD
Start([å»ºç«‹è¿æ¥]) --> Handshake[TLSæ¡æ‰‹]
Handshake --> Detect[æ£€æµ‹åå•†åè®®]
Detect --> HTTP2{åè®®æ˜¯HTTP/2?}
HTTP2 --> |æ˜¯| HTTP2Client[ä½¿ç”¨HTTP/2å®¢æˆ·ç«¯]
HTTP2 --> |å¦| HTTP1Client[ä½¿ç”¨HTTP/1.1å®¢æˆ·ç«¯]
HTTP2Client --> SendRequest[å‘é€HTTP/2è¯·æ±‚]
HTTP1Client --> BuildRequest[æ„å»ºåŸå§‹HTTPè¯·æ±‚]
BuildRequest --> SendRequest
SendRequest --> ReceiveResponse[æ¥æ”¶å“åº”]
ReceiveResponse --> End([å®Œæˆ])
```

**å›¾è¡¨æ¥æº**
- [utlsclient/utlsclient.go](file://utlsclient/utlsclient.go#L130-L141)

### HTTP/2 æ”¯æŒç‰¹æ€§

1. **è¿æ¥å¤ç”¨**: å•ä¸ª TCP è¿æ¥æ”¯æŒå¤šè·¯å¤ç”¨
2. **æœåŠ¡å™¨æ¨é€**: æ”¯æŒ HTTP/2 æœåŠ¡å™¨æ¨é€
3. **å¤´éƒ¨å‹ç¼©**: HPACK å‹ç¼©å‡å°‘ä¼ è¾“å¼€é”€
4. **æµä¼˜å…ˆçº§**: æ”¯æŒæµä¼˜å…ˆçº§æ§åˆ¶

### HTTP/1.1 å®ç°

å¯¹äº HTTP/1.1 åè®®ï¼Œç³»ç»Ÿå®ç°äº†å®Œæ•´çš„åŸå§‹è¯·æ±‚æ„å»ºå’Œå“åº”è§£æï¼š

```mermaid
classDiagram
class UTLSClient {
+conn : *UTLSConnection
+timeout : time.Duration
+userAgent : string
+maxRetries : int
+Do(req) *http.Response
+doHTTP1Request(req) *http.Response
+buildRawRequest(req) string
+readResponse(reader) *http.Response
}
class responseBody {
+reader : *bufio.Reader
+conn : *utls.UConn
+closed : bool
+mu : sync.Mutex
+Read(p) int
+Close() error
}
UTLSClient --> responseBody
```

**å›¾è¡¨æ¥æº**
- [utlsclient/utlsclient.go](file://utlsclient/utlsclient.go#L37-L52)
- [utlsclient/utlsclient.go](file://utlsclient/utlsclient.go#L333-L363)

### IPv6 å®Œæ•´æ”¯æŒ

ç³»ç»Ÿå®Œå…¨æ”¯æŒ IPv6 åœ°å€è¿æ¥ï¼ŒåŒ…æ‹¬ï¼š

- **åœ°å€æ ¼å¼å¤„ç†**: è‡ªåŠ¨è¯†åˆ«å’Œå¤„ç† IPv6 åœ°å€æ ¼å¼
- **æ–¹æ‹¬å·åŒ…è£¹**: æ­£ç¡®å¤„ç† IPv6 åœ°å€çš„æ–¹æ‹¬å·æ ¼å¼
- **åŒæ ˆç½‘ç»œ**: åŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6
- **éš§é“æ¨¡å¼**: æ”¯æŒé€šè¿‡ IPv6 éš§é“è¿æ¥

**ç« èŠ‚æ¥æº**
- [utlsclient/utlsclient.go](file://utlsclient/utlsclient.go#L1-L392)

## Google Earth Q2æ•°æ®è§£æä¸å­˜å‚¨

### è®¾è®¡ç›®çš„

æ–°å¢ Google Earth Q2 æ•°æ®è§£æä¸å­˜å‚¨åŠŸèƒ½ï¼Œæ—¨åœ¨æä¾›å®Œæ•´çš„ Google Earth æ•°æ®é‡‡é›†å’Œå­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚è¯¥åŠŸèƒ½æ”¯æŒä» Google Earth æœåŠ¡å™¨è·å–ã€è§£æå’Œå­˜å‚¨ Q2 æ•°æ®åŒ…ï¼ŒåŒ…æ‹¬å½±åƒã€åœ°å½¢å’ŒçŸ¢é‡æ•°æ®ã€‚

### å®ç°ç»†èŠ‚

#### Q2æ•°æ®è§£æå™¨

Q2Parser æ¥å£æä¾›ä¸¤ç§è§£ææ–¹å¼ï¼šè¿”å›ç»“æ„ä½“æˆ– JSON å­—ç¬¦ä¸²ã€‚æ”¯æŒè‡ªå®šä¹‰ URL æ„é€ ç­–ç•¥å’Œæ•°æ®è¿‡æ»¤ç­–ç•¥ã€‚

```go
// Q2Parser å®šä¹‰Q2è§£ææ¥å£ï¼Œæ”¯æŒè¾“å‡ºç»“æ„ä½“æˆ–JSON
type Q2Parser interface {
    // Parse è§£æä¸ºç»“æ„ä½“ï¼ˆç®€åŒ–è¾“å‡ºç»“æ„ï¼‰
    Parse(body []byte, tilekey string, rootNode bool, baseURL string) (*Q2Response, error)
    // ParseToJSON è§£æä¸ºJSONå­—ç¬¦ä¸²ï¼ˆä¸ ParseQ2Body è¾“å‡ºä¸€è‡´ï¼‰
    ParseToJSON(body []byte, tilekey string, rootNode bool, baseURL string) (string, error)
}
```

#### dbRootè§£æå™¨

DbRootParser æ¥å£ç”¨äºè§£æ Google Earth çš„ dbRoot.v5 æ–‡ä»¶ï¼Œæå–ç‰ˆæœ¬å·ã€åŠ å¯†å¯†é’¥å’Œ XML æ•°æ®ã€‚

```go
// DbRootParser DbRoot è§£æå™¨æ¥å£
type DbRootParser interface {
    // Parse è§£æ dbRoot.v5 åŸå§‹æ•°æ®
    Parse(body []byte) (*DbRootData, error)
    // GetVersion è·å–ç‰ˆæœ¬å·
    GetVersion() uint16
    // GetCryptKey è·å–è§£å¯†å¯†é’¥
    GetCryptKey() []byte
    // GetXMLData è·å– XML æ•°æ®
    GetXMLData() []byte
}
```

#### ç“¦ç‰‡å­˜å‚¨ç®¡ç†å™¨

TileStorage æä¾›ç»Ÿä¸€çš„ç“¦ç‰‡æ•°æ®å­˜å‚¨æ¥å£ï¼Œæ”¯æŒ bbolt å’Œ SQLite ä¸¤ç§æŒä¹…åŒ–åç«¯ï¼Œå¹¶å¯é€‰ Redis ç¼“å­˜ã€‚

```go
// TileStorageConfig ç“¦ç‰‡å­˜å‚¨é…ç½®
type TileStorageConfig struct {
    Backend StorageBackend // æŒä¹…åŒ–åç«¯é€‰æ‹©ï¼ˆbbolt æˆ– sqliteï¼‰
    DBDir string           // æŒä¹…åŒ–æ•°æ®åº“ç›®å½•
    RedisAddr string       // Redis åœ°å€ï¼ˆä¸ºç©ºåˆ™ç¦ç”¨ç¼“å­˜ï¼‰
    CacheExpiration time.Duration // Redis ç¼“å­˜è¿‡æœŸæ—¶é—´
    EnableCache bool       // æ˜¯å¦å¯ç”¨ Redis ç¼“å­˜
    EnableAsyncPersist bool // æ˜¯å¦å¯ç”¨å¼‚æ­¥æŒä¹…åŒ–
    PersistBatchSize int   // å¼‚æ­¥æŒä¹…åŒ–æ‰¹æ¬¡å¤§å°
    PersistInterval time.Duration // å¼‚æ­¥æŒä¹…åŒ–é—´éš”
    ClearRedisAfterPersist *bool // æŒä¹…åŒ–æˆåŠŸåæ˜¯å¦æ¸…ç† Redis
}
```

### å·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
participant Client as å®¢æˆ·ç«¯
participant Auth as è®¤è¯ç®¡ç†å™¨
participant DBRoot as dbRootè§£æå™¨
participant Q2Parser as Q2è§£æå™¨
participant Storage as å­˜å‚¨ç®¡ç†å™¨
participant Target as Google EarthæœåŠ¡å™¨
Client->>Auth : GetAuth()
Auth->>Target : POST /geauth
Target-->>Auth : è¿”å›Session
Auth-->>Client : è¿”å›Session
Client->>DBRoot : ParseDbRootComplete()
DBRoot->>Target : GET /dbRoot.v5
Target-->>DBRoot : è¿”å›åŠ å¯†æ•°æ®
DBRoot->>DBRoot : è§£å¯†å¹¶è§£æ
DBRoot-->>Client : è¿”å›ç‰ˆæœ¬å·ã€å¯†é’¥ã€XML
Client->>Q2Parser : ParseQ2Body()
Q2Parser->>Target : GET /flatfile?q2-0-q.1029
Target-->>Q2Parser : è¿”å›åŠ å¯†Q2æ•°æ®
Q2Parser->>Q2Parser : è§£å¯†å¹¶è§£æ
Q2Parser-->>Client : è¿”å›JSON/ç»“æ„ä½“
Client->>Storage : Put()
Storage->>SQLite : å†™å…¥SQLiteæ•°æ®åº“
Storage->>Redis : å†™å…¥Redisç¼“å­˜(å¯é€‰)
Storage-->>Client : ç¡®è®¤å­˜å‚¨
```

**å›¾è¡¨æ¥æº**
- [GoogleEarth/geq2.go](file://GoogleEarth/geq2.go#L155-L208)
- [GoogleEarth/gedbroot.go](file://GoogleEarth/gedbroot.go#L142-L180)
- [Store/tilestorage.go](file://Store/tilestorage.go#L201-L227)

### å…³é”®ç‰¹æ€§

1. **å®Œæ•´çš„Q2æ•°æ®è§£æ**: æ”¯æŒè§£æ Q2 æ•°æ®åŒ…ä¸­çš„å½±åƒã€åœ°å½¢ã€çŸ¢é‡å’Œå­èŠ‚ç‚¹å¼•ç”¨
2. **çµæ´»çš„URLæ„é€ **: æ”¯æŒè‡ªå®šä¹‰ URL æ„é€ ç­–ç•¥ï¼Œå¯ç”Ÿæˆå®Œæ•´çš„è¯·æ±‚ URL
3. **æ•°æ®è¿‡æ»¤æœºåˆ¶**: æ”¯æŒæ ¹æ®é€‰é¡¹è¿‡æ»¤è¾“å‡ºçš„æ•°æ®ç±»å‹
4. **å¤šåç«¯å­˜å‚¨æ”¯æŒ**: æ”¯æŒ bbolt å’Œ SQLite ä¸¤ç§æŒä¹…åŒ–åç«¯
5. **å¼‚æ­¥æŒä¹…åŒ–**: æ”¯æŒå¼‚æ­¥æŒä¹…åŒ–æ¨¡å¼ï¼Œæé«˜å†™å…¥æ€§èƒ½
6. **Redisç¼“å­˜é›†æˆ**: å¯é€‰ Redis ç¼“å­˜ï¼Œæå‡è¯»å–æ€§èƒ½

**ç« èŠ‚æ¥æº**
- [GoogleEarth/geq2.go](file://GoogleEarth/geq2.go#L1-L481)
- [Store/sqlitedb.go](file://Store/sqlitedb.go#L14-L255)
- [Store/tilestorage.go](file://Store/tilestorage.go#L1-L454)

## åŠŸèƒ½ä¾èµ–å…³ç³»åˆ†æ

### æ ¸å¿ƒä¾èµ–é“¾

```mermaid
graph TD
UTLSHotConnPool[çƒ­è¿æ¥æ± ] --> ConnectionManager[è¿æ¥ç®¡ç†å™¨]
UTLSHotConnPool --> HealthChecker[å¥åº·æ£€æŸ¥å™¨]
UTLSHotConnPool --> ConnectionValidator[è¿æ¥éªŒè¯å™¨]
UTLSHotConnPool --> IPAccessController[IPè®¿é—®æ§åˆ¶å™¨]
ConnectionManager --> UTLSConnection[UTLSè¿æ¥]
HealthChecker --> ConnectionManager
ConnectionValidator --> UTLSConnection
UTLSHotConnPool --> Library[TLSæŒ‡çº¹åº“]
UTLSHotConnPool --> IPPoolProvider[IPæ± æä¾›è€…]
UTLSClient[UTLSå®¢æˆ·ç«¯] --> UTLSConnection
UTLSClient --> HTTP2Transport[HTTP/2ä¼ è¾“]
UTLSClient --> HTTP1Transport[HTTP/1.1ä¼ è¾“]
IPPoolProvider --> LocalIPPool[æœ¬åœ°IPæ± ]
IPPoolProvider --> RemoteIPPool[è¿œç¨‹IPæ± ]
UTLSClient --> Auth[è®¤è¯ç®¡ç†å™¨]
Auth --> DbRootParser[dbRootè§£æå™¨]
DbRootParser --> Q2Parser[Q2è§£æå™¨]
Q2Parser --> TileStorage[ç“¦ç‰‡å­˜å‚¨ç®¡ç†å™¨]
TileStorage --> SQLiteManager[SQLiteç®¡ç†å™¨]
TileStorage --> RedisClient[Rediså®¢æˆ·ç«¯]
```

**å›¾è¡¨æ¥æº**
- [utlsclient/utlshotconnpool.go](file://utlsclient/utlshotconnpool.go#L236-L258)
- [utlsclient/connection_manager.go](file://utlsclient/connection_manager.go#L8-L14)
- [GoogleEarth/geq2.go](file://GoogleEarth/geq2.go#L1-L481)
- [Store/tilestorage.go](file://Store/tilestorage.go#L42-L51)

### äº¤äº’æµç¨‹

1. **çƒ­è¿æ¥æ± ** ä¾èµ– **TLSæŒ‡çº¹åº“** æä¾›æŒ‡çº¹é…ç½®
2. **çƒ­è¿æ¥æ± ** ä½¿ç”¨ **IPæ± ç®¡ç†å™¨** è·å–å¯ç”¨ IP åœ°å€
3. **è¿æ¥ç®¡ç†å™¨** ç®¡ç† **UTLSè¿æ¥** çš„ç”Ÿå‘½å‘¨æœŸ
4. **å¥åº·æ£€æŸ¥å™¨** å®šæœŸéªŒè¯è¿æ¥çŠ¶æ€
5. **UTLSå®¢æˆ·ç«¯** ä½¿ç”¨ **HTTP/1.1/HTTP/2ä¼ è¾“** å‘é€è¯·æ±‚
6. **UTLSå®¢æˆ·ç«¯** è°ƒç”¨ **è®¤è¯ç®¡ç†å™¨** è·å– Google Earth è®¤è¯
7. **è®¤è¯ç®¡ç†å™¨** ä½¿ç”¨ **dbRootè§£æå™¨** è§£æåŠ å¯†å¯†é’¥
8. **dbRootè§£æå™¨** æä¾›å¯†é’¥ç»™ **Q2è§£æå™¨** è§£å¯†æ•°æ®
9. **Q2è§£æå™¨** å°†è§£æç»“æœä¼ é€’ç»™ **ç“¦ç‰‡å­˜å‚¨ç®¡ç†å™¨** å­˜å‚¨

### æ•°æ®æµå‘

```mermaid
flowchart LR
Config[é…ç½®æ–‡ä»¶] --> Pool[çƒ­è¿æ¥æ± ]
FingerprintLib[TLSæŒ‡çº¹åº“] --> Pool
IPPool[IPæ± ] --> Pool
Pool --> ConnMgr[è¿æ¥ç®¡ç†å™¨]
ConnMgr --> HealthCheck[å¥åº·æ£€æŸ¥]
ConnMgr --> Validator[è¿æ¥éªŒè¯]
Pool --> Client[UTLSå®¢æˆ·ç«¯]
Client --> HTTP1[HTTP/1.1å¤„ç†]
Client --> HTTP2[HTTP/2å¤„ç†]
Client --> Auth[è®¤è¯ç®¡ç†]
Auth --> DBRoot[dbRootè§£æ]
DBRoot --> Q2Parser[Q2è§£æ]
Q2Parser --> Storage[å­˜å‚¨ç®¡ç†]
Storage --> SQLite[SQLiteå­˜å‚¨]
Storage --> Redis[Redisç¼“å­˜]
```

**ç« èŠ‚æ¥æº**
- [utlsclient/utlshotconnpool.go](file://utlsclient/utlshotconnpool.go#L291-L350)
- [GoogleEarth/geq2.go](file://GoogleEarth/geq2.go#L155-L208)
- [Store/tilestorage.go](file://Store/tilestorage.go#L201-L227)

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### è¿æ¥æ± ä¼˜åŒ–

1. **åˆç†é…ç½®è¿æ¥æ•°**
   - `MaxConnections`: æ ¹æ®å¹¶å‘éœ€æ±‚è®¾ç½®
   - `MaxConnsPerHost`: æ§åˆ¶å•ä¸»æœºè¿æ¥æ•°
   - `MaxIdleConns`: ä¿æŒé€‚é‡ç©ºé—²è¿æ¥

2. **è¶…æ—¶å‚æ•°è°ƒä¼˜**
   - `ConnTimeout`: è¿æ¥å»ºç«‹è¶…æ—¶æ—¶é—´
   - `IdleTimeout`: ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´
   - `MaxLifetime`: è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸ

3. **å¥åº·æ£€æŸ¥ä¼˜åŒ–**
   - `HealthCheckInterval`: å¥åº·æ£€æŸ¥é—´éš”
   - `TestTimeout`: æµ‹è¯•è¯·æ±‚è¶…æ—¶æ—¶é—´

### IPæ± ä¼˜åŒ–

1. **æœ¬åœ°IPæ± **
   - åˆç†é…ç½®é™æ€IPv4åœ°å€
   - æ ¹æ®ç½‘ç»œç¯å¢ƒè°ƒæ•´IPv6æ”¯æŒ

2. **è¿œç¨‹IPæ± **
   - è®¾ç½®åˆé€‚çš„æ›´æ–°é—´éš”
   - ä¼˜åŒ–DNSæŸ¥è¯¢å¹¶å‘æ•°

### TLSæŒ‡çº¹ä¼˜åŒ–

1. **æŒ‡çº¹é€‰æ‹©ç­–ç•¥**
   - æ ¹æ®ç›®æ ‡ç½‘ç«™ç‰¹å¾é€‰æ‹©åˆé€‚æŒ‡çº¹
   - å®šæœŸè½®æ¢æŒ‡çº¹ç±»å‹

2. **è¯­è¨€éšæœºåŒ–**
   - æ ¹æ®ç›®æ ‡åœ°åŒºè°ƒæ•´è¯­è¨€ç»„åˆ
   - å¹³è¡¡éšæœºæ€§å’Œç‹¬ç‰¹æ€§

### Google Earth Q2è§£æä¼˜åŒ–

1. **æ‰¹é‡å¤„ç†**
   - ä½¿ç”¨ `PutTilesSQLiteBatch` æ‰¹é‡å†™å…¥æ•°æ®ï¼Œæ€§èƒ½æ¯”é€æ¡å†™å…¥æå‡æ•°å€
   - é…ç½®åˆé€‚çš„ `PersistBatchSize` å’Œ `PersistInterval`

2. **ç¼“å­˜ç­–ç•¥**
   - å¯ç”¨ Redis ç¼“å­˜ï¼Œå‡å°‘å¯¹æŒä¹…åŒ–å­˜å‚¨çš„è®¿é—®
   - è®¾ç½®åˆç†çš„ `CacheExpiration` æ—¶é—´

3. **å¼‚æ­¥æŒä¹…åŒ–**
   - å¯ç”¨å¼‚æ­¥æŒä¹…åŒ–æ¨¡å¼ï¼Œæé«˜å†™å…¥æ€§èƒ½
   - ç›‘æ§ `GetPendingPersistCount` é˜²æ­¢é˜Ÿåˆ—ç§¯å‹

**ç« èŠ‚æ¥æº**
- [utlsclient/utlshotconnpool.go](file://utlsclient/utlshotconnpool.go#L170-L202)
- [Store/sqlitedb.go](file://Store/sqlitedb.go#L151-L211)
- [Store/tilestorage.go](file://Store/tilestorage.go#L115-L197)

## æœ€ä½³å®è·µæŒ‡å—

### ä½¿ç”¨çƒ­è¿æ¥æ± 

```mermaid
sequenceDiagram
participant App as åº”ç”¨ç¨‹åº
participant Pool as çƒ­è¿æ¥æ± 
participant Client as UTLSå®¢æˆ·ç«¯
App->>Pool : NewUTLSHotConnPool(config)
App->>Pool : GetConnection(host)
Pool-->>App : è¿”å›è¿æ¥
App->>Client : NewUTLSClient(conn)
App->>Client : å‘é€HTTPè¯·æ±‚
Client-->>App : è¿”å›å“åº”
App->>Pool : PutConnection(conn)
App->>Pool : Close()
```

**å›¾è¡¨æ¥æº**
- [examples/utlsclient/example_hotconnpool_usage.go](file://examples/utlsclient/example_hotconnpool_usage.go#L46-L116)

### Google Earth Q2æ•°æ®å¤„ç†

```go
// åˆ›å»ºè¿æ¥æ± 
config := &utlsclient.PoolConfig{
    MaxConnections: 100,
    MaxConnsPerHost: 10,
    ConnTimeout: 30 * time.Second,
}
pool := utlsclient.NewUTLSHotConnPool(config)

// åˆ›å»ºè®¤è¯ç®¡ç†å™¨
auth := GoogleEarth.NewAuth(pool)

// è·å–è®¤è¯
session, err := auth.GetAuth()
if err != nil {
    log.Fatal(err)
}

// åˆ›å»ºå®¢æˆ·ç«¯
conn, err := pool.GetConnection(GoogleEarth.HOST_NAME)
if err != nil {
    log.Fatal(err)
}
defer pool.PutConnection(conn)
client := utlsclient.NewUTLSClient(conn)

// è®¾ç½®Cookie
client.SetHeader("Cookie", fmt.Sprintf("SessionId=%s;State=1", session))

// è¯·æ±‚dbRoot
resp, err := client.Get("https://" + GoogleEarth.HOST_NAME + GoogleEarth.DBROOT_PATH)
if err != nil {
    log.Fatal(err)
}
defer resp.Body.Close()

// è§£ædbRoot
body, _ := io.ReadAll(resp.Body)
dbRootData, err := GoogleEarth.ParseDbRootComplete(body)
if err != nil {
    log.Fatal(err)
}

// æ›´æ–°å…¨å±€å¯†é’¥
GoogleEarth.CryptKey = dbRootData.CryptKey

// è¯·æ±‚Q2æ•°æ®
q2URL := fmt.Sprintf("https://%s/flatfile?q2-0-q.1029", GoogleEarth.HOST_NAME)
resp, err = client.Get(q2URL)
if err != nil {
    log.Fatal(err)
}
defer resp.Body.Close()

// è§£å¯†Q2æ•°æ®
encryptedBody, _ := io.ReadAll(resp.Body)
decryptedBody, err := GoogleEarth.UnpackGEZlib(encryptedBody)
if err != nil {
    log.Fatal(err)
}

// è§£æQ2æ•°æ®
jsonStr, err := GoogleEarth.ParseQ2Body(decryptedBody, "0", true, "https://kh.google.com")
if err != nil {
    log.Fatal(err)
}

// å­˜å‚¨æ•°æ®
config := Store.TileStorageConfig{
    Backend: Store.BackendSQLite,
    DBDir: "./data",
    EnableCache: true,
    RedisAddr: "localhost:6379",
    EnableAsyncPersist: true,
}
storage, _ := Store.NewTileStorage(config)
storage.Put("q2", "0", []byte(jsonStr))
```

**ç« èŠ‚æ¥æº**
- [GoogleEarth/geq2.go](file://GoogleEarth/geq2.go#L155-L208)
- [Store/tilestorage.go](file://Store/tilestorage.go#L201-L227)

### æ¨èä½¿ç”¨æ¨¡å¼

1. **é¢„çƒ­è¿æ¥**: åœ¨å¼€å§‹å¤§è§„æ¨¡è¯·æ±‚å‰é¢„çƒ­è¿æ¥æ± 
2. **è½®è¯¢ä½¿ç”¨**: é‡‡ç”¨ã€è·å–-ä½¿ç”¨-å½’è¿˜ã€‘æ¨¡å¼
3. **å¹¶å‘æ§åˆ¶**: åˆç†æ§åˆ¶å¹¶å‘æ•°å’Œè¯·æ±‚é¢‘ç‡
4. **é”™è¯¯å¤„ç†**: å®ç°å®Œå–„çš„é”™è¯¯é‡è¯•æœºåˆ¶
5. **èµ„æºæ¸…ç†**: ä½¿ç”¨ defer ç¡®ä¿è¿æ¥å’Œèµ„æºæ­£ç¡®é‡Šæ”¾

### é…ç½®å»ºè®®

1. **è¿æ¥æ± é…ç½®**
   ```go
   config := &PoolConfig{
       MaxConnections:         100,
       MaxConnsPerHost:        10,
       ConnTimeout:            30 * time.Second,
       IdleTimeout:            60 * time.Second,
       MaxLifetime:            300 * time.Second,
   }
   ```

2. **è¶…æ—¶è®¾ç½®**
   ```go
   client.SetTimeout(15 * time.Second)
   ```

3. **é”™è¯¯é‡è¯•**
   ```go
   client.SetMaxRetries(3)
   ```

4. **å­˜å‚¨é…ç½®**
   ```go
   config := Store.TileStorageConfig{
       Backend: Store.BackendSQLite,
       DBDir: "./data",
       EnableCache: true,
       RedisAddr: "localhost:6379",
       CacheExpiration: 24 * time.Hour,
       EnableAsyncPersist: true,
       PersistBatchSize: 100,
       PersistInterval: 5 * time.Second,
   }
   ```

**ç« èŠ‚æ¥æº**
- [examples/utlsclient/example_hotconnpool_usage.go](file://examples/utlsclient/example_hotconnpool_usage.go#L1-L277)
- [examples/utlsclient/example_utlsclient_usage.go](file://examples/utlsclient/example_utlsclient_usage.go#L1-L117)
- [Store/tilestorage.go](file://Store/tilestorage.go#L61-L113)

## æ€»ç»“

Crawler Platform é€šè¿‡åˆ›æ–°çš„æŠ€æœ¯ç»„åˆï¼Œå®ç°äº†é«˜æ€§èƒ½å’Œé«˜éšè”½æ€§çš„çˆ¬è™«è§£å†³æ–¹æ¡ˆï¼š

### æ ¸å¿ƒä¼˜åŠ¿

1. **æ€§èƒ½å“è¶Š**: çƒ­è¿æ¥æ± æŠ€æœ¯å®ç° 3-6 å€æ€§èƒ½æå‡
2. **éšè”½æ€§å¼º**: TLS æŒ‡çº¹ä¼ªè£…å’Œå¤šè¯­è¨€éšæœºåŒ–
3. **ç¨³å®šæ€§é«˜**: å®Œå–„çš„å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡è¯•æœºåˆ¶
4. **æ‰©å±•æ€§å¥½**: æ¨¡å—åŒ–è®¾è®¡æ”¯æŒçµæ´»é…ç½®
5. **åŠŸèƒ½å®Œæ•´**: æ–°å¢ Google Earth Q2 æ•°æ®è§£æä¸å­˜å‚¨åŠŸèƒ½

### æŠ€æœ¯åˆ›æ–°

- **æ™ºèƒ½è¿æ¥å¤ç”¨**: é¿å…é‡å¤ TLS æ¡æ‰‹å¼€é”€
- **åŠ¨æ€æŒ‡çº¹é€‰æ‹©**: æ ¹æ®ç›®æ ‡ç½‘ç«™ç‰¹å¾é€‰æ‹©æœ€ä¼˜æŒ‡çº¹
- **åŒæ ˆç½‘ç»œæ”¯æŒ**: åŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6
- **å®æ—¶IPç›‘æ§**: è¿œç¨‹åŸŸåIPæ± åŠ¨æ€æ›´æ–°
- **å®Œæ•´Q2è§£æ**: æ”¯æŒ Q2 æ•°æ®åŒ…çš„å®Œæ•´è§£æå’Œå­˜å‚¨
- **å¤šåç«¯å­˜å‚¨**: æ”¯æŒ bbolt å’Œ SQLite ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆ

### åº”ç”¨åœºæ™¯

- **Webçˆ¬è™«**: é«˜æ•ˆæŠ“å–ç½‘é¡µå†…å®¹
- **APIæµ‹è¯•**: æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¯·æ±‚
- **å®‰å…¨ç ”ç©¶**: åˆ†æWebåº”ç”¨å®‰å…¨é˜²æŠ¤
- **æ•°æ®é‡‡é›†**: å¤§è§„æ¨¡æ•°æ®æ”¶é›†
- **åœ°ç†ä¿¡æ¯é‡‡é›†**: Google Earth æ•°æ®é‡‡é›†ä¸åˆ†æ

é€šè¿‡åˆç†é…ç½®å’Œä½¿ç”¨è¿™äº›æ ¸å¿ƒåŠŸèƒ½ï¼Œå¼€å‘è€…å¯ä»¥æ„å»ºå‡ºé«˜æ•ˆã€ç¨³å®šçš„çˆ¬è™«ç³»ç»Ÿï¼ŒåŒæ—¶ä¿æŒè‰¯å¥½çš„éšè”½æ€§ã€‚